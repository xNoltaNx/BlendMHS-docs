<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Feedback - BlendMHS Documentation</title>
    <link rel="stylesheet" href="../../css/styles.css" />
    <style>
      /* Feedback Form Styles */
      .feedback-form {
        max-width: 100%;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-label {
        display: block;
        color: var(--accent-blue);
        font-weight: 600;
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
      }

      .form-label .required {
        color: var(--primary);
        margin-left: 0.25rem;
      }

      .form-input,
      .form-textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        background: var(--bg-code);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-light);
        font-family: inherit;
        font-size: 1rem;
        transition: border-color 0.2s, box-shadow 0.2s;
      }

      .form-input:focus,
      .form-textarea:focus {
        outline: none;
        border-color: var(--accent-blue);
        box-shadow: 0 0 0 3px rgba(74, 158, 255, 0.2);
      }

      .form-input::placeholder,
      .form-textarea::placeholder {
        color: var(--text-muted);
      }

      .form-textarea {
        min-height: 150px;
        resize: vertical;
      }

      /* File Upload Styles */
      .file-upload-area {
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: border-color 0.2s, background 0.2s;
        background: var(--bg-code);
      }

      .file-upload-area:hover {
        border-color: var(--accent-blue);
        background: rgba(74, 158, 255, 0.05);
      }

      .file-upload-area.dragover {
        border-color: var(--primary);
        background: rgba(232, 125, 13, 0.1);
      }

      .file-upload-icon {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
      }

      .file-upload-text {
        color: var(--text-muted);
        margin-bottom: 0.5rem;
      }

      .file-upload-hint {
        color: var(--text-muted);
        font-size: 0.8rem;
      }

      .file-input {
        display: none;
      }

      .file-preview {
        margin-top: 1rem;
        padding: 0.75rem;
        background: var(--bg-card);
        border-radius: 8px;
        display: none;
        align-items: center;
        gap: 0.75rem;
      }

      .file-preview.has-file {
        display: flex;
      }

      .file-preview-icon {
        font-size: 1.5rem;
      }

      .file-preview-info {
        flex: 1;
      }

      .file-preview-name {
        color: var(--text-light);
        font-weight: 500;
      }

      .file-preview-size {
        color: var(--text-muted);
        font-size: 0.8rem;
      }

      .file-remove-btn {
        background: rgba(239, 68, 68, 0.2);
        border: none;
        color: #ef4444;
        padding: 0.5rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        transition: background 0.2s;
      }

      .file-remove-btn:hover {
        background: rgba(239, 68, 68, 0.4);
      }

/* Submit Button */
      .form-actions {
        text-align: center;
        margin-top: 1.5rem;
      }

      .submit-btn {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        color: white;
        border: none;
        padding: 1rem 2rem;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(232, 125, 13, 0.3);
      }

      .submit-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .submit-btn .spinner {
        display: none;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      .submit-btn.loading .spinner {
        display: inline-block;
      }

      .submit-btn.loading .btn-text {
        display: none;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      /* Status Messages */
      .form-status {
        padding: 1rem;
        border-radius: 8px;
        margin-top: 1rem;
        display: none;
      }

      .form-status.success {
        display: block;
        background: rgba(74, 222, 128, 0.15);
        border: 1px solid var(--accent-green);
        color: var(--accent-green);
      }

      .form-status.error {
        display: block;
        background: rgba(239, 68, 68, 0.15);
        border: 1px solid #ef4444;
        color: #ef4444;
      }

      /* Setup Notice */
      .setup-notice {
        background: rgba(251, 191, 36, 0.15);
        border: 1px solid #fbbf24;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1.5rem;
      }

      .setup-notice-title {
        color: #fbbf24;
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .setup-notice p {
        color: var(--text-muted);
        font-size: 0.9rem;
        margin: 0;
      }

      .setup-notice code {
        background: var(--bg-code);
        padding: 0.15rem 0.4rem;
        border-radius: 4px;
        font-size: 0.85rem;
      }
    </style>
  </head>
  <body>
    <div class="page-wrapper">
      <nav class="sidebar">
        <div class="sidebar-header">
          <a href="../../index.html">
            <img src="../../images/BlendMHS_BannerSq.png" alt="BlendMHS" class="sidebar-logo" onerror="this.style.display='none'" />
          </a>
          <div class="sidebar-title">
            <span class="blend">Blend</span><span class="mhs">MHS</span> Docs
          </div>
        </div>
        <div class="sidebar-nav">
          <div class="nav-section">
            <div class="nav-section-title"><span>Getting Started</span><span class="chevron">‚ñº</span></div>
            <ul class="nav-items">
              <li class="nav-item"><a href="../../index.html" class="nav-link"><span class="nav-icon">üè†</span>Overview</a></li>
            </ul>
          </div>
          <div class="nav-section">
            <div class="nav-section-title"><span>UI Panels</span><span class="chevron">‚ñº</span></div>
            <ul class="nav-items">
              <li class="nav-item"><a href="../ui-panels/project-management.html" class="nav-link"><span class="nav-icon">üìÅ</span>Project Management</a></li>
              <li class="nav-item"><a href="../ui-panels/quick-export.html" class="nav-link"><span class="nav-icon">‚ö°</span>Quick Export</a></li>
              <li class="nav-item"><a href="../ui-panels/layout-setup.html" class="nav-link"><span class="nav-icon">üó∫Ô∏è</span>Layout Setup</a></li>
              <li class="nav-item"><a href="../ui-panels/mesh-setup.html" class="nav-link"><span class="nav-icon">üî∑</span>Mesh Setup</a></li>
              <li class="nav-item"><a href="../ui-panels/animation-setup.html" class="nav-link"><span class="nav-icon">üé¨</span>Animation Setup</a></li>
              <li class="nav-item"><a href="../ui-panels/material-settings.html" class="nav-link"><span class="nav-icon">üé®</span>Material Settings</a></li>
            </ul>
          </div>
          <div class="nav-section">
            <div class="nav-section-title"><span>Preferences</span><span class="chevron">‚ñº</span></div>
            <ul class="nav-items">
              <li class="nav-item"><a href="../preferences/addon-preferences.html" class="nav-link"><span class="nav-icon">‚öôÔ∏è</span>Addon Preferences</a></li>
            </ul>
          </div>
<div class="nav-section">
            <div class="nav-section-title"><span>MHS Integration</span><span class="chevron">‚ñº</span></div>
            <ul class="nav-items">
              <li class="nav-item"><a href="mhs-toolkit.html" class="nav-link"><span class="nav-icon">üîß</span>MHS Toolkit</a></li>
            </ul>
          </div>
          <div class="nav-section">
            <div class="nav-section-title"><span>Feedback</span><span class="chevron">‚ñº</span></div>
            <ul class="nav-items">
              <li class="nav-item"><a href="feedback.html" class="nav-link active"><span class="nav-icon">üí¨</span>Submit Feedback</a></li>
            </ul>
          </div>
        </div>
        <div class="sidebar-footer">
          <img src="../../images/meta-horizon.svg" alt="Meta Horizon" class="sidebar-footer-logo" />
        </div>
      </nav>

      <button class="mobile-menu-toggle" onclick="toggleSidebar()">‚ò∞</button>

      <main class="main-content">
        <div class="container">
          <div class="breadcrumb">
            <a href="../../index.html">Home</a>
            <span class="separator">‚Ä∫</span>
            <span class="current">Feedback</span>
          </div>

          <div class="page-header">
            <h1 class="page-title"><span class="icon">üí¨</span>Feedback</h1>
            <p class="page-description">Report issues, suggest improvements, or share your experience with BlendMHS. Your feedback helps make the addon better!</p>
          </div>

          <h2>Submit Feedback</h2>

          <!-- Setup Notice - Remove this once configured -->
          <div class="setup-notice" id="setup-notice">
            <div class="setup-notice-title">‚ö†Ô∏è Setup Required</div>
            <p>This form requires a Google Apps Script backend. Update the <code>SCRIPT_URL</code> in the JavaScript below with your deployed Apps Script URL.</p>
          </div>

          <div class="card feedback-form">
            <form id="feedback-form">
              <div class="form-group">
                <label class="form-label" for="title">
                  Title <span class="required">*</span>
                </label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  class="form-input"
                  placeholder="Brief summary of the issue or suggestion"
                  required
                />
              </div>

              <div class="form-group">
                <label class="form-label" for="description">
                  Description <span class="required">*</span>
                </label>
                <textarea
                  id="description"
                  name="description"
                  class="form-textarea"
                  placeholder="Provide details about the issue or suggestion. Include steps to reproduce if reporting a bug."
                  required
                ></textarea>
              </div>

              <div class="form-group">
                <label class="form-label" for="attachment">
                  Attachment <span style="color: var(--text-muted); font-weight: normal;">(optional)</span>
                </label>
                <div class="file-upload-area" id="file-upload-area">
                  <div class="file-upload-icon">üìé</div>
                  <div class="file-upload-text">Click to upload or drag and drop</div>
                  <div class="file-upload-hint">PNG, JPG, GIF, or PDF up to 5MB</div>
                  <input type="file" id="attachment" name="attachment" class="file-input" accept=".png,.jpg,.jpeg,.gif,.pdf" />
                </div>
                <div class="file-preview" id="file-preview">
                  <span class="file-preview-icon">üìÑ</span>
                  <div class="file-preview-info">
                    <div class="file-preview-name" id="file-name"></div>
                    <div class="file-preview-size" id="file-size"></div>
                  </div>
                  <button type="button" class="file-remove-btn" id="file-remove" title="Remove file">‚úï</button>
                </div>
              </div>

<div class="form-actions">
              <button type="submit" class="submit-btn" id="submit-btn">
                <span class="btn-text">üì§ Submit Feedback</span>
                <span class="spinner"></span>
              </button>
              </div>

              <div class="form-status" id="form-status"></div>
            </form>
          </div>

          <h2>What Happens Next?</h2>
          <div class="card">
            <div class="feature-grid">
              <div class="feature-item">
                <div class="feature-icon">üì•</div>
                <div class="feature-content">
                  <h4>Feedback Received</h4>
                  <p>Your feedback is logged to a spreadsheet for review by the BlendMHS team.</p>
                </div>
              </div>
              <div class="feature-item">
                <div class="feature-icon">üëÄ</div>
                <div class="feature-content">
                  <h4>Review & Triage</h4>
                  <p>We review submissions regularly and prioritize based on impact and frequency.</p>
                </div>
              </div>
              <div class="feature-item">
                <div class="feature-icon">üîß</div>
                <div class="feature-content">
                  <h4>Implementation</h4>
                  <p>Fixes and features are incorporated into upcoming BlendMHS releases.</p>
                </div>
              </div>
            </div>
          </div>

          <footer>
            <p>BlendMHS Documentation ‚Äî Meta Horizon Studio Pipeline</p>
            <p>¬© 2025 Meta</p>
          </footer>
        </div>
      </main>
    </div>

    <script>
      // =====================================================
      // CONFIGURATION - Update this URL after deploying your Google Apps Script
      // =====================================================
      const SCRIPT_URL = 'https://script.google.com/a/macros/meta.com/s/AKfycbzSd-K8cEFY8Q93buzt8euL1yr2n3xa1DjyE-a7NEv5KZvwoVd9jR59CHn-O_Qyndit/exec'; // <-- Paste your deployed Apps Script URL here

      // =====================================================
      // Form Handling
      // =====================================================
      const form = document.getElementById('feedback-form');
      const submitBtn = document.getElementById('submit-btn');
      const formStatus = document.getElementById('form-status');
      const fileInput = document.getElementById('attachment');
      const fileUploadArea = document.getElementById('file-upload-area');
      const filePreview = document.getElementById('file-preview');
      const fileName = document.getElementById('file-name');
      const fileSize = document.getElementById('file-size');
      const fileRemove = document.getElementById('file-remove');
      const setupNotice = document.getElementById('setup-notice');

      // Hide setup notice if SCRIPT_URL is configured
      if (SCRIPT_URL) {
        setupNotice.style.display = 'none';
      }

      // File upload handling
      fileUploadArea.addEventListener('click', () => fileInput.click());

      fileUploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        fileUploadArea.classList.add('dragover');
      });

      fileUploadArea.addEventListener('dragleave', () => {
        fileUploadArea.classList.remove('dragover');
      });

      fileUploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          updateFilePreview();
        }
      });

      fileInput.addEventListener('change', updateFilePreview);

      fileRemove.addEventListener('click', () => {
        fileInput.value = '';
        filePreview.classList.remove('has-file');
      });

      function updateFilePreview() {
        if (fileInput.files.length > 0) {
          const file = fileInput.files[0];

          // Check file size (5MB limit)
          if (file.size > 5 * 1024 * 1024) {
            showStatus('File too large. Maximum size is 5MB.', 'error');
            fileInput.value = '';
            return;
          }

          fileName.textContent = file.name;
          fileSize.textContent = formatFileSize(file.size);
          filePreview.classList.add('has-file');
        }
      }

      function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
      }

      // Form submission
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!SCRIPT_URL) {
          showStatus('Form not configured. Please set up the Google Apps Script backend.', 'error');
          return;
        }

        submitBtn.disabled = true;
        submitBtn.classList.add('loading');
        formStatus.className = 'form-status';

        try {
          const title = document.getElementById('title').value.trim();
          const description = document.getElementById('description').value.trim();

          // Format timestamp in a readable way (e.g., "Dec 23, 2025, 2:42:25 AM")
          const now = new Date();
          const formattedTimestamp = now.toLocaleString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            second: '2-digit',
            hour12: true
          });

          // Prepare form data
          const formData = {
            title: title,
            description: description,
            timestamp: formattedTimestamp,
            fileName: '',
            fileData: '',
            fileType: ''
          };

          // Handle file attachment
          if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            formData.fileName = file.name;
            formData.fileType = file.type;
            formData.fileData = await fileToBase64(file);
          }

console.log('Starting submission...');
          console.log('Form data:', formData);

          // Create a hidden iframe for form submission (most reliable cross-origin method)
          const iframeName = 'feedback-iframe-' + Date.now();
          const iframe = document.createElement('iframe');
          iframe.name = iframeName;
          iframe.style.display = 'none';
          document.body.appendChild(iframe);

          // Create a hidden form targeting the iframe
          const hiddenForm = document.createElement('form');
          hiddenForm.method = 'POST';
          hiddenForm.action = SCRIPT_URL;
          hiddenForm.target = iframeName;
          hiddenForm.style.display = 'none';

          // Add form fields (including file data if present)
          const fields = {
            title: formData.title,
            description: formData.description,
            timestamp: formData.timestamp,
            fileName: formData.fileName || '',
            fileData: formData.fileData || '',
            fileType: formData.fileType || ''
          };

          for (const [key, value] of Object.entries(fields)) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = key;
            input.value = value;
            hiddenForm.appendChild(input);
          }

          document.body.appendChild(hiddenForm);
          console.log('Submitting form to:', SCRIPT_URL);
          hiddenForm.submit();

          // Clean up after submission
          await new Promise(resolve => setTimeout(resolve, 2000));
          try {
            document.body.removeChild(hiddenForm);
            document.body.removeChild(iframe);
          } catch(e) {}

          // With no-cors, we can't read the response, but if no error thrown, assume success
          showStatus('Thank you! Your feedback has been submitted successfully.', 'success');
          form.reset();
          filePreview.classList.remove('has-file');

        } catch (error) {
          console.error('Submission error:', error);
          showStatus('There was an error submitting your feedback. Please try again.', 'error');
        } finally {
          submitBtn.disabled = false;
          submitBtn.classList.remove('loading');
        }
      });

      function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = () => resolve(reader.result);
          reader.onerror = error => reject(error);
        });
      }

      function showStatus(message, type) {
        formStatus.textContent = message;
        formStatus.className = 'form-status ' + type;
      }

      // Sidebar toggle
      function toggleSidebar() {
        document.querySelector(".sidebar").classList.toggle("open");
      }

      document.querySelectorAll(".nav-section-title").forEach((title) => {
        title.addEventListener("click", () => {
          title.parentElement.classList.toggle("collapsed");
        });
      });
    </script>
  </body>
</html>
